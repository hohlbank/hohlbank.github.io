<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hohl Bank - –í—Ö–æ–¥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            min-height: 100vh;
            color: #fff;
        }
        
        .container {
            background: #2d2d2d;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            max-width: 400px;
            width: 100%;
            margin: 50px auto;
        }
        
        .container.wide { max-width: 1400px; }
        
        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
            padding: 40px 30px;
            text-align: center;
            color: white;
            border-bottom: 2px solid #3d3d3d;
        }
        
        .logo { font-size: 48px; margin-bottom: 10px; }
        .header h1 { font-size: 32px; font-weight: 700; margin-bottom: 5px; }
        .header p { font-size: 14px; opacity: 0.7; }
        
        .form-container { padding: 40px 30px; }
        .form-group { margin-bottom: 25px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #fff;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-group input, input[type="text"], input[type="password"], input[type="number"], textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #3d3d3d;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #1a1a1a;
            color: #fff;
        }
        
        .form-group input:focus, input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #5a9fd4;
            box-shadow: 0 0 0 3px rgba(90, 159, 212, 0.2);
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #5a9fd4 0%, #4a8fc4 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(90, 159, 212, 0.4);
        }
        
        .btn:active { transform: translateY(0); }
        
        .btn-primary { background: linear-gradient(135deg, #5a9fd4 0%, #4a8fc4 100%); }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }
        .btn-secondary { background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #218838 100%); }
        
        .message {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            display: none;
        }
        
        .message.success {
            background: rgba(40, 167, 69, 0.2);
            color: #4caf50;
            border: 1px solid #4caf50;
        }
        
        .message.error {
            background: rgba(220, 53, 69, 0.2);
            color: #f44336;
            border: 1px solid #f44336;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-tabs {
            display: flex;
            background: #1a1a1a;
            border-bottom: 2px solid #3d3d3d;
            padding: 0 20px;
        }
        
        .nav-tab {
            padding: 15px 30px;
            background: none;
            border: none;
            color: #999;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-tab:hover { color: #5a9fd4; }
        .nav-tab.active { color: #fff; }
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #5a9fd4;
        }
        
        .dashboard { display: none; }
        .dashboard-content { display: none; padding: 40px; }
        .dashboard-content.active { display: block; }
        
        /* –ë–∞–Ω–∫ - –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω */
        .dashboard-layout {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 30px;
        }
        
        .left-section, .right-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .user-info, .card-section, .transfer-section, .notifications-section {
            background: #2d2d2d;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #3d3d3d;
        }

        .user-info {
            background: #2d2d2d;
        }

        .user-info-item {
            margin-bottom: 12px;
            font-size: 14px;
        }

        .user-info-item strong {
            color: #999;
            font-weight: 400;
        }

        .user-info-item span {
            color: #fff;
            margin-left: 5px;
        }

        .logout-btn {
            width: 100%;
            margin-top: 15px;
        }
        
        h3 { 
            color: #fff; 
            margin-bottom: 20px; 
            font-size: 18px;
            font-weight: 600;
        }
        
        .bank-card {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-radius: 15px;
            padding: 25px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid #3d3d3d;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }
        
        .card-logo { 
            font-size: 28px;
        }
        
        .card-type {
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 1px;
            opacity: 0.9;
        }
        
        .card-chip {
            width: 45px;
            height: 35px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-radius: 6px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .card-number {
            font-size: 20px;
            letter-spacing: 2px;
            margin-bottom: 18px;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }
        
        .card-footer {
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }
        
        .card-info { flex: 1; }
        .card-label {
            font-size: 11px;
            opacity: 0.6;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .card-value {
            font-size: 14px;
            font-weight: 600;
        }

        .balance-section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #3d3d3d;
        }

        .balance-label {
            font-size: 13px;
            color: #999;
            margin-bottom: 8px;
        }

        .balance-amount {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .card-actions button {
            flex: 1;
            padding: 10px;
            font-size: 14px;
        }

        /* –ü–µ—Ä–µ–≤–æ–¥—ã - –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω */
        .transfer-mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #1a1a1a;
            padding: 5px;
            border-radius: 10px;
        }

        .transfer-mode-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: #999;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .transfer-mode-btn.active {
            background: #5a9fd4;
            color: #fff;
        }

        .transfer-mode-btn:hover:not(.active) {
            color: #fff;
        }

        .transfer-input-group {
            margin-bottom: 20px;
        }

        .transfer-input-group input {
            width: 100%;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #2d2d2d;
            border-radius: 15px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            border: 1px solid #3d3d3d;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .modal-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #5a9fd4 0%, #4a8fc4 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .transfer-detail {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #3d3d3d;
        }

        .transfer-detail-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }

        .transfer-detail-value {
            font-size: 16px;
            color: #fff;
            font-weight: 600;
        }

        .transfer-amount {
            font-size: 32px !important;
            color: #5a9fd4;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
        }

        .modal-actions button {
            flex: 1;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ */
        .history-section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #3d3d3d;
        }

        .history-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
        }

        .history-empty {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 14px;
        }

        .history-item {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #3d3d3d;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            border-color: #5a9fd4;
            transform: translateX(5px);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-item-type {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        .history-item-amount {
            font-size: 16px;
            font-weight: 700;
        }

        .history-item-amount.positive {
            color: #28a745;
        }

        .history-item-amount.negative {
            color: #dc3545;
        }

        .history-item-details {
            font-size: 12px;
            color: #999;
        }

        /* –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä */
        .messenger-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 0;
            height: 700px;
            background: #2d2d2d;
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #3d3d3d;
        }

        .chats-list {
            background: #1a1a1a;
            border-right: 1px solid #3d3d3d;
            display: flex;
            flex-direction: column;
        }

        .chats-header {
            padding: 20px;
            border-bottom: 1px solid #3d3d3d;
        }

        .chats-header h3 {
            margin-bottom: 15px;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px;
            background: #5a9fd4;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .new-chat-btn:hover {
            background: #4a8fc4;
        }

        .chats-items {
            overflow-y: auto;
            flex: 1;
        }

        .chat-item {
            padding: 15px 20px;
            border-bottom: 1px solid #3d3d3d;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chat-item:hover {
            background: #2d2d2d;
        }

        .chat-item.active {
            background: #2d2d2d;
            border-left: 3px solid #5a9fd4;
        }

        .chat-item-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #fff;
        }

        .chat-item-last {
            font-size: 13px;
            color: #999;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-window {
            display: flex;
            flex-direction: column;
            background: #2d2d2d;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #3d3d3d;
            background: #1a1a1a;
        }

        .chat-header-name {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-empty {
            text-align: center;
            padding: 50px 20px;
            color: #666;
        }

        .chat-empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .message-item {
            display: flex;
            gap: 10px;
            max-width: 70%;
        }

        .message-item.own {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            background: #5a9fd4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message-content {
            background: #1a1a1a;
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid #3d3d3d;
        }

        .message-item.own .message-content {
            background: #5a9fd4;
            border-color: #5a9fd4;
        }

        .message-author {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #5a9fd4;
        }

        .message-item.own .message-author {
            color: rgba(255, 255, 255, 0.9);
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
            color: #fff;
            word-wrap: break-word;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .message-item.own .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid #3d3d3d;
            background: #1a1a1a;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            background: #2d2d2d;
            border: 1px solid #3d3d3d;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            resize: none;
            max-height: 120px;
        }

        .chat-send-btn {
            width: 50px;
            height: 50px;
            background: #5a9fd4;
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-send-btn:hover {
            background: #4a8fc4;
        }

        /* –ù–æ–≤—ã–π —á–∞—Ç - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .new-chat-modal {
            padding: 30px;
        }

        .new-chat-modal h3 {
            margin-bottom: 20px;
        }

        .user-search-input {
            width: 100%;
            margin-bottom: 20px;
        }

        .users-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .user-list-item {
            padding: 12px 15px;
            background: #1a1a1a;
            border: 1px solid #3d3d3d;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-list-item:hover {
            border-color: #5a9fd4;
            transform: translateX(5px);
        }

        .user-list-name {
            font-weight: 600;
            color: #fff;
            margin-bottom: 3px;
        }

        .user-list-username {
            font-size: 12px;
            color: #999;
        }

        /* –§–æ—Ä—É–º/–ü–æ—Å—Ç—ã */
        .forum-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        .threads-section {
            background: #2d2d2d;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #3d3d3d;
        }

        .new-thread-btn {
            width: 100%;
            margin-bottom: 20px;
            padding: 14px;
        }

        .threads-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .thread-item {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #3d3d3d;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .thread-item:hover {
            border-color: #5a9fd4;
            transform: translateY(-2px);
        }

        .thread-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .thread-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }

        .thread-author {
            font-size: 13px;
            color: #5a9fd4;
        }

        .thread-date {
            font-size: 12px;
            color: #999;
        }

        .thread-preview {
            font-size: 14px;
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .thread-stats {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #999;
        }

        .thread-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–µ–¥–∞ */
        .thread-view {
            display: none;
            background: #2d2d2d;
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #3d3d3d;
        }

        .thread-view.active {
            display: block;
        }

        .back-to-threads {
            background: #1a1a1a;
            color: #5a9fd4;
            padding: 10px 20px;
            border: 1px solid #3d3d3d;
            border-radius: 8px;
            margin-bottom: 20px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .back-to-threads:hover {
            border-color: #5a9fd4;
        }

        .thread-main-post {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #3d3d3d;
            margin-bottom: 25px;
        }

        .thread-main-header {
            margin-bottom: 20px;
        }

        .thread-main-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #fff;
        }

        .thread-main-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #999;
        }

        .thread-main-body {
            font-size: 15px;
            line-height: 1.8;
            color: #fff;
        }

        .thread-replies-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #fff;
        }

        .thread-reply {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #3d3d3d;
            margin-bottom: 15px;
        }

        .reply-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .reply-author {
            font-weight: 600;
            color: #5a9fd4;
        }

        .reply-date {
            font-size: 12px;
            color: #999;
        }

        .reply-body {
            font-size: 14px;
            line-height: 1.6;
            color: #fff;
        }

        .reply-form {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #3d3d3d;
            margin-top: 20px;
        }

        .reply-form textarea {
            width: 100%;
            min-height: 100px;
            margin-bottom: 15px;
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Ñ–æ—Ä—É–º–∞ */
        .forum-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .forum-widget {
            background: #2d2d2d;
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #3d3d3d;
        }

        .widget-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
        }

        .widget-content {
            font-size: 14px;
            color: #ccc;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .notification-item {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #3d3d3d;
            border-left: 3px solid #5a9fd4;
        }

        .notification-item.success {
            border-left-color: #28a745;
        }

        .notification-item.warning {
            border-left-color: #ffc107;
        }

        .notification-item.error {
            border-left-color: #dc3545;
        }

        .notification-message {
            font-size: 14px;
            color: #fff;
            margin-bottom: 8px;
        }

        .notification-date {
            font-size: 11px;
            color: #999;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-section {
            background: #2d2d2d;
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #3d3d3d;
            margin-bottom: 25px;
        }

        .settings-section h3 {
            margin-bottom: 20px;
        }

        .login-history-item {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #3d3d3d;
            margin-bottom: 10px;
        }

        .login-date {
            font-size: 14px;
            color: #fff;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .login-ip {
            font-size: 12px;
            color: #999;
        }

        /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */
        .admin-only {
            display: none;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #3d3d3d;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #5a9fd4;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #999;
        }

        .users-table {
            width: 100%;
            background: #2d2d2d;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #3d3d3d;
        }

        .users-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .users-table th {
            background: #1a1a1a;
            padding: 15px;
            text-align: left;
            font-size: 13px;
            color: #999;
            font-weight: 600;
            border-bottom: 1px solid #3d3d3d;
        }

        .users-table td {
            padding: 15px;
            border-bottom: 1px solid #3d3d3d;
            font-size: 14px;
        }

        .users-table tr:hover {
            background: #1a1a1a;
        }

        .action-btn {
            padding: 6px 12px;
            font-size: 12px;
            margin-right: 5px;
            border-radius: 5px;
        }

        @media (max-width: 1200px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }

            .messenger-layout {
                grid-template-columns: 1fr;
            }

            .forum-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <div class="header">
            <div class="logo">üí≥</div>
            <h1 id="pageTitle">Hohl Bank</h1>
            <p id="pageSubtitle">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞</p>
        </div>

        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div id="loginForm" class="form-container">
            <div class="form-group">
                <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" autocomplete="username">
            </div>
            
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="current-password">
            </div>
            
            <button class="btn btn-primary" onclick="handleLogin()">–í–æ–π—Ç–∏</button>
            
            <div id="message" class="message"></div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div id="dashboard" class="dashboard">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchSection('bank')">–ë–∞–Ω–∫</button>
                <button class="nav-tab" onclick="switchSection('messenger')">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</button>
                <button class="nav-tab" onclick="switchSection('posts')">–§–æ—Ä—É–º</button>
                <button class="nav-tab" onclick="switchSection('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button class="nav-tab admin-only" onclick="switchSection('admin')">–ê–¥–º–∏–Ω</button>
            </div>

            <!-- –ë–∞–Ω–∫ -->
            <div id="bankSection" class="dashboard-content active">
                <div class="dashboard-layout">
                    <div class="left-section">
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                        <div class="user-info">
                            <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
                            <div class="user-info-item">
                                <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong><span id="userDisplayName"></span>
                            </div>
                            <div class="user-info-item">
                                <strong>–ù–∏–∫–Ω–µ–π–º:</strong><span id="userNickname"></span>
                            </div>
                            <div class="user-info-item">
                                <strong>–í—Ä–µ–º—è –≤—Ö–æ–¥–∞:</strong><span id="userLoginTime"></span>
                            </div>
                            <button class="btn btn-danger logout-btn" onclick="handleLogout()">–í—ã–π—Ç–∏</button>
                        </div>

                        <!-- –ö–∞—Ä—Ç–∞ -->
                        <div class="card-section">
                            <h3>–ú–æ—è –∫–∞—Ä—Ç–∞</h3>
                            <div id="cardDisplay"></div>
                        </div>
                    </div>

                    <div class="right-section">
                        <!-- –ü–µ—Ä–µ–≤–æ–¥—ã -->
                        <div class="transfer-section">
                            <h3>üí∏ –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
                            
                            <div class="transfer-mode-selector">
                                <button class="transfer-mode-btn active" onclick="setTransferMode('nickname')">–ü–æ –Ω–∏–∫–Ω–µ–π–º—É</button>
                                <button class="transfer-mode-btn" onclick="setTransferMode('card')">–ü–æ –Ω–æ–º–µ—Ä—É –∫–∞—Ä—Ç—ã</button>
                            </div>

                            <div class="transfer-input-group">
                                <input type="text" id="transferRecipient" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
                            </div>

                            <div style="text-align: center; margin-bottom: 15px; font-size: 12px; color: #999;">
                                <span id="recipientHint">–ù–∞–ø—Ä–∏–º–µ—Ä: genka - –ì–µ55</span>
                            </div>

                            <button class="btn btn-success" onclick="initiateTransfer()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>

                            <!-- –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ -->
                            <div class="history-section">
                                <div class="history-title">–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤</div>
                                <div id="transferHistory"></div>
                            </div>
                        </div>

                        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                        <div class="notifications-section">
                            <h3>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                            <div id="notificationsList" class="notifications-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä -->
            <div id="messengerSection" class="dashboard-content">
                <div class="messenger-layout">
                    <div class="chats-list">
                        <div class="chats-header">
                            <h3>–ß–∞—Ç—ã</h3>
                            <button class="new-chat-btn" onclick="showNewChatModal()">‚ûï –ù–æ–≤—ã–π —á–∞—Ç</button>
                        </div>
                        <div class="chats-items" id="chatsList"></div>
                    </div>

                    <div class="chat-window">
                        <div class="chat-header">
                            <div class="chat-header-name" id="currentChatName">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-empty">
                                <div class="chat-empty-icon">üí¨</div>
                                <div>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π</div>
                            </div>
                        </div>
                        <div class="chat-input-area" id="chatInputArea" style="display: none;">
                            <div class="chat-input-container">
                                <textarea class="chat-input" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." rows="1"></textarea>
                                <button class="chat-send-btn" onclick="sendChatMessage()">‚û§</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –§–æ—Ä—É–º -->
            <div id="postsSection" class="dashboard-content">
                <div class="forum-layout">
                    <div class="threads-section">
                        <div id="threadsListView">
                            <button class="btn btn-primary new-thread-btn" onclick="showNewThreadModal()">‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–µ–º—É</button>
                            <div class="threads-list" id="threadsList"></div>
                        </div>

                        <div id="threadView" class="thread-view"></div>
                    </div>

                    <div class="forum-sidebar">
                        <div class="forum-widget">
                            <div class="widget-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                            <div class="widget-content" id="forumStats">
                                –ó–∞–≥—Ä—É–∑–∫–∞...
                            </div>
                        </div>

                        <div class="forum-widget">
                            <div class="widget-title">‚ÑπÔ∏è –û —Ñ–æ—Ä—É–º–µ</div>
                            <div class="widget-content">
                                –§–æ—Ä—É–º Hohl Bank - –º–µ—Å—Ç–æ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div id="settingsSection" class="dashboard-content">
                <div class="settings-section">
                    <h3>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
                    <div class="form-group">
                        <label>–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</label>
                        <input type="text" id="displayNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    <button class="btn btn-primary" onclick="updateDisplayName()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>

                <div class="settings-section">
                    <h3>üîê –ò—Å—Ç–æ—Ä–∏—è –≤—Ö–æ–¥–æ–≤</h3>
                    <div id="loginHistoryList"></div>
                </div>

                <div class="settings-section">
                    <h3>üí∏ –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
                    <div id="allTransactionsList"></div>
                </div>
            </div>

            <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
            <div id="adminSection" class="dashboard-content admin-only">
                <div class="settings-section">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="admin-stats" id="adminStats"></div>
                </div>

                <div class="settings-section">
                    <h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
                    <div class="users-table" id="usersTable"></div>
                </div>

                <div class="settings-section">
                    <h3>üì¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h3>
                    <div class="form-group">
                        <label>–¢–∏–ø</label>
                        <select id="notificationType">
                            <option value="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option>
                            <option value="success">–£—Å–ø–µ—Ö</option>
                            <option value="warning">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</option>
                            <option value="error">–û—à–∏–±–∫–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
                        <select id="notificationRecipient">
                            <option value="all">–í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                        <textarea id="notificationText" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="sendNotification()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ -->
    <div class="modal" id="transferModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">üí∏</div>
                <div class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞</div>
            </div>
            <div class="modal-body">
                <div class="transfer-detail">
                    <div class="transfer-detail-label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</div>
                    <div class="transfer-detail-value" id="modalRecipientName"></div>
                </div>
                <div class="transfer-detail">
                    <div class="transfer-detail-label">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div>
                    <div class="transfer-detail-value" id="modalRecipientCard"></div>
                </div>
                <div class="transfer-detail">
                    <div class="transfer-detail-label">–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞</div>
                    <input type="number" id="modalTransferAmount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" style="width: 100%; margin-top: 10px;">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeTransferModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-success" onclick="confirmTransfer()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞ -->
    <div class="modal" id="newChatModal">
        <div class="modal-content new-chat-modal">
            <h3>–ù–æ–≤—ã–π —á–∞—Ç</h3>
            <input type="text" class="user-search-input" id="userSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...">
            <div class="users-list" id="usersList"></div>
            <button class="btn btn-secondary" style="margin-top: 15px;" onclick="closeNewChatModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–æ–≤–æ–π —Ç–µ–º—ã -->
    <div class="modal" id="newThreadModal">
        <div class="modal-content">
            <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É</h3>
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã</label>
                <input type="text" id="threadTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã">
            </div>
            <div class="form-group">
                <label>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                <textarea id="threadContent" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeNewThreadModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="createNewThread()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCUGASAMPLE_CONFIG_REPLACE_THIS",
            authDomain: "your-app.firebaseapp.com",
            databaseURL: "https://your-app.firebaseio.com",
            projectId: "your-project-id",
            storageBucket: "your-app.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentUsername = '';
        let isAdmin = false;
        let balanceVisible = false;
        let currentSection = 'bank';
        let titleStage = '–í—Ö–æ–¥';
        let transferMode = 'nickname';
        let transferRecipientData = null;
        let currentChatId = null;

        // –í—Ö–æ–¥
        async function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const messageEl = document.getElementById('message');

            if (!username || !password) {
                showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                const snapshot = await database.ref('users/' + username).once('value');
                
                if (!snapshot.exists()) {
                    showMessage('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                    return;
                }

                const userData = snapshot.val();
                
                if (userData.password !== password) {
                    showMessage('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                    return;
                }

                currentUsername = username;
                isAdmin = userData.isAdmin || false;

                // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é
                localStorage.setItem('hohlgramSession', JSON.stringify({
                    username: username,
                    timestamp: Date.now()
                }));

                // –ó–∞–ø–∏—Å–∞—Ç—å –≤—Ö–æ–¥
                await database.ref('loginHistory/' + username).push({
                    timestamp: new Date().toISOString(),
                    ip: 'Hidden'
                });

                // –°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—É –µ—Å–ª–∏ –Ω–µ—Ç
                const cardSnapshot = await database.ref('cards/' + username).once('value');
                if (!cardSnapshot.exists()) {
                    await createDefaultCard(username);
                }

                showDashboard();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ', 'error');
            }
        }

        async function createDefaultCard(username) {
            const cardNumber = generateCardNumber();
            await database.ref('cards/' + username).set({
                number: cardNumber,
                balance: 1000,
                holder: username.toUpperCase(),
                validThru: '12/28',
                createdAt: new Date().toISOString()
            });

            await database.ref('cardHistory/' + username).push({
                action: 'create',
                cardNumber: cardNumber,
                timestamp: new Date().toISOString()
            });
        }

        function generateCardNumber() {
            let number = '';
            for (let i = 0; i < 16; i++) {
                number += Math.floor(Math.random() * 10);
            }
            return number.match(/.{1,4}/g).join(' ');
        }

        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = 'message ' + type;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }

        async function showDashboard() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('mainContainer').classList.add('wide');
            
            const userSnapshot = await database.ref('users/' + currentUsername).once('value');
            const userData = userSnapshot.val();

            document.getElementById('userDisplayName').textContent = ' ' + (userData.displayName || currentUsername);
            document.getElementById('userNickname').textContent = ' ' + currentUsername;
            document.getElementById('userLoginTime').textContent = ' ' + new Date().toLocaleString('ru-RU');

            if (isAdmin) {
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
            }

            loadCard();
            loadTransferHistory();
            loadNotifications();
            loadChats();
        }

        async function loadCard() {
            const cardSnapshot = await database.ref('cards/' + currentUsername).once('value');
            const cardData = cardSnapshot.val();

            if (!cardData) {
                document.getElementById('cardDisplay').innerHTML = '<p>–ö–∞—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>';
                return;
            }

            const cardHTML = `
                <div class="bank-card">
                    <div class="card-header">
                        <div class="card-logo">üí≥</div>
                        <div class="card-type">HOHL</div>
                    </div>
                    <div class="card-chip"></div>
                    <div class="card-number">${cardData.number}</div>
                    <div class="card-footer">
                        <div class="card-info">
                            <div class="card-label">–í–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç—ã</div>
                            <div class="card-value">${cardData.holder}</div>
                        </div>
                        <div class="card-info">
                            <div class="card-label">–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –¥–æ</div>
                            <div class="card-value">${cardData.validThru}</div>
                        </div>
                    </div>
                </div>
                <div class="balance-section">
                    <div class="balance-label">–ë–∞–ª–∞–Ω—Å</div>
                    <div class="balance-amount">${Math.floor(cardData.balance)} √ê</div>
                </div>
                <div class="card-actions">
                    <button class="btn btn-secondary" onclick="showFullBalance()">–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π —Å—á–µ—Ç</button>
                    <button class="btn btn-danger" onclick="reissueCard()">–ü–µ—Ä–µ–≤—ã–ø—É—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                </div>
            `;

            document.getElementById('cardDisplay').innerHTML = cardHTML;

            database.ref('cards/' + currentUsername).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.querySelector('.balance-amount').textContent = Math.floor(data.balance) + ' √ê';
                }
            });
        }

        function showFullBalance() {
            database.ref('cards/' + currentUsername).once('value').then((snapshot) => {
                const cardData = snapshot.val();
                alert(`–ü–æ–ª–Ω—ã–π –±–∞–ª–∞–Ω—Å: ${Math.floor(cardData.balance)} √ê`);
            });
        }

        async function reissueCard() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–≤—ã–ø—É—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É? –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –∏–∑–º–µ–Ω–∏—Ç—Å—è.')) {
                return;
            }

            try {
                const cardSnapshot = await database.ref('cards/' + currentUsername).once('value');
                const oldCard = cardSnapshot.val();
                const newCardNumber = generateCardNumber();

                await database.ref('cards/' + currentUsername + '/number').set(newCardNumber);

                await database.ref('cardHistory/' + currentUsername).push({
                    action: 'reissue',
                    oldCardNumber: oldCard.number,
                    newCardNumber: newCardNumber,
                    timestamp: new Date().toISOString()
                });

                await database.ref('notifications/' + currentUsername).push({
                    type: 'success',
                    message: '–ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–≤—ã–ø—É—â–µ–Ω–∞. –ù–æ–≤—ã–π –Ω–æ–º–µ—Ä: ' + newCardNumber,
                    date: new Date().toISOString()
                });

                loadCard();
                alert('–ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ–≤—ã–ø—É—â–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤—ã–ø—É—Å–∫–∞ –∫–∞—Ä—Ç—ã:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤—ã–ø—É—Å–∫–µ –∫–∞—Ä—Ç—ã');
            }
        }

        // –ü–µ—Ä–µ–≤–æ–¥—ã
        function setTransferMode(mode) {
            transferMode = mode;
            document.querySelectorAll('.transfer-mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const input = document.getElementById('transferRecipient');
            const hint = document.getElementById('recipientHint');

            if (mode === 'nickname') {
                input.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è';
                hint.textContent = '–ù–∞–ø—Ä–∏–º–µ—Ä: genka - –ì–µ55';
            } else {
                input.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã';
                hint.textContent = '–ù–∞–ø—Ä–∏–º–µ—Ä: 4532 7050 9798 9754';
            }

            input.value = '';
            transferRecipientData = null;
        }

        async function initiateTransfer() {
            const recipientInput = document.getElementById('transferRecipient').value.trim();

            if (!recipientInput) {
                alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è');
                return;
            }

            try {
                let recipientUsername = null;
                let recipientCard = null;

                if (transferMode === 'nickname') {
                    // –ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫–Ω–µ–π–º—É
                    const userSnapshot = await database.ref('users/' + recipientInput).once('value');
                    if (!userSnapshot.exists()) {
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return;
                    }

                    const cardSnapshot = await database.ref('cards/' + recipientInput).once('value');
                    if (!cardSnapshot.exists()) {
                        alert('–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∫–∞—Ä—Ç—ã');
                        return;
                    }

                    recipientUsername = recipientInput;
                    recipientCard = cardSnapshot.val();
                } else {
                    // –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ä—Ç–µ
                    const cardsSnapshot = await database.ref('cards').once('value');
                    let found = false;

                    cardsSnapshot.forEach((child) => {
                        const cardData = child.val();
                        if (cardData.number === recipientInput) {
                            recipientUsername = child.key;
                            recipientCard = cardData;
                            found = true;
                        }
                    });

                    if (!found) {
                        alert('–ö–∞—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                        return;
                    }
                }

                if (recipientUsername === currentUsername) {
                    alert('–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å–∞–º–æ–º—É —Å–µ–±–µ');
                    return;
                }

                // –ü–æ–ª—É—á–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userSnapshot = await database.ref('users/' + recipientUsername).once('value');
                const userData = userSnapshot.val();

                // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                transferRecipientData = {
                    username: recipientUsername,
                    displayName: userData.displayName || recipientUsername,
                    cardNumber: recipientCard.number
                };

                document.getElementById('modalRecipientName').textContent = transferRecipientData.displayName;
                document.getElementById('modalRecipientCard').textContent = transferRecipientData.cardNumber;
                document.getElementById('modalTransferAmount').value = '';
                document.getElementById('transferModal').classList.add('active');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è');
            }
        }

        function closeTransferModal() {
            document.getElementById('transferModal').classList.remove('active');
            transferRecipientData = null;
        }

        async function confirmTransfer() {
            const amount = parseInt(document.getElementById('modalTransferAmount').value);

            if (!amount || amount <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                return;
            }

            if (!transferRecipientData) {
                alert('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }

            try {
                const senderCardSnapshot = await database.ref('cards/' + currentUsername).once('value');
                const senderCard = senderCardSnapshot.val();

                if (senderCard.balance < amount) {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                    return;
                }

                // –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥
                await database.ref('cards/' + currentUsername + '/balance').set(Math.floor(senderCard.balance - amount));
                
                const recipientCardSnapshot = await database.ref('cards/' + transferRecipientData.username).once('value');
                const recipientCard = recipientCardSnapshot.val();
                await database.ref('cards/' + transferRecipientData.username + '/balance').set(Math.floor(recipientCard.balance + amount));

                // –ó–∞–ø–∏—Å–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
                await database.ref('transfers/' + currentUsername).push({
                    type: 'sent',
                    amount: amount,
                    recipient: transferRecipientData.username,
                    recipientName: transferRecipientData.displayName,
                    date: new Date().toISOString()
                });

                // –ó–∞–ø–∏—Å–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª—É—á–∞—Ç–µ–ª—è
                const senderUserSnapshot = await database.ref('users/' + currentUsername).once('value');
                const senderUserData = senderUserSnapshot.val();

                await database.ref('transfers/' + transferRecipientData.username).push({
                    type: 'received',
                    amount: amount,
                    sender: currentUsername,
                    senderName: senderUserData.displayName || currentUsername,
                    date: new Date().toISOString()
                });

                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                await database.ref('notifications/' + currentUsername).push({
                    type: 'success',
                    message: `–ü–µ—Ä–µ–≤–æ–¥ ${amount} √ê –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${transferRecipientData.displayName} –≤—ã–ø–æ–ª–Ω–µ–Ω`,
                    date: new Date().toISOString()
                });

                await database.ref('notifications/' + transferRecipientData.username).push({
                    type: 'success',
                    message: `–ü–æ–ª—É—á–µ–Ω –ø–µ—Ä–µ–≤–æ–¥ ${amount} √ê –æ—Ç ${senderUserData.displayName || currentUsername}`,
                    date: new Date().toISOString()
                });

                closeTransferModal();
                document.getElementById('transferRecipient').value = '';
                alert('–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–∞');
            }
        }

        async function loadTransferHistory() {
            const snapshot = await database.ref('transfers/' + currentUsername).once('value');
            const history = [];

            snapshot.forEach((child) => {
                history.push(child.val());
            });

            history.sort((a, b) => new Date(b.date) - new Date(a.date));

            const historyHTML = history.length > 0 
                ? history.slice(0, 5).map(item => {
                    const isReceived = item.type === 'received';
                    return `
                        <div class="history-item">
                            <div class="history-item-header">
                                <div class="history-item-type">${isReceived ? '‚Üê –û—Ç' : '‚Üí –ö–æ–º—É'}: ${isReceived ? item.senderName : item.recipientName}</div>
                                <div class="history-item-amount ${isReceived ? 'positive' : 'negative'}">
                                    ${isReceived ? '+' : '-'}${item.amount} √ê
                                </div>
                            </div>
                            <div class="history-item-details">${new Date(item.date).toLocaleString('ru-RU')}</div>
                        </div>
                    `;
                }).join('')
                : '<div class="history-empty">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';

            document.getElementById('transferHistory').innerHTML = historyHTML;
        }

        async function loadNotifications() {
            database.ref('notifications/' + currentUsername).limitToLast(10).on('value', (snapshot) => {
                const notifications = [];
                snapshot.forEach((child) => {
                    notifications.push(child.val());
                });

                notifications.reverse();

                const notificationsHTML = notifications.length > 0
                    ? notifications.map(notif => `
                        <div class="notification-item ${notif.type}">
                            <div class="notification-message">${notif.message}</div>
                            <div class="notification-date">${new Date(notif.date).toLocaleString('ru-RU')}</div>
                        </div>
                    `).join('')
                    : '<div class="history-empty">–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>';

                document.getElementById('notificationsList').innerHTML = notificationsHTML;
            });
        }

        // –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
        async function loadChats() {
            database.ref('chats').on('value', (snapshot) => {
                const chats = [];
                snapshot.forEach((child) => {
                    const chatData = child.val();
                    if (chatData.participants && chatData.participants[currentUsername]) {
                        chats.push({
                            id: child.key,
                            ...chatData
                        });
                    }
                });

                chats.sort((a, b) => new Date(b.lastMessage?.timestamp || 0) - new Date(a.lastMessage?.timestamp || 0));

                const chatsHTML = chats.length > 0
                    ? chats.map(chat => {
                        const otherUser = Object.keys(chat.participants).find(u => u !== currentUsername);
                        return `
                            <div class="chat-item ${currentChatId === chat.id ? 'active' : ''}" onclick="openChat('${chat.id}', '${otherUser}')">
                                <div class="chat-item-name">${chat.participants[otherUser]}</div>
                                <div class="chat-item-last">${chat.lastMessage?.text || '–ù–æ–≤—ã–π —á–∞—Ç'}</div>
                            </div>
                        `;
                    }).join('')
                    : '<div style="padding: 20px; text-align: center; color: #666;">–ù–µ—Ç —á–∞—Ç–æ–≤</div>';

                document.getElementById('chatsList').innerHTML = chatsHTML;
            });
        }

        function showNewChatModal() {
            database.ref('users').once('value').then((snapshot) => {
                const users = [];
                snapshot.forEach((child) => {
                    if (child.key !== currentUsername && child.key !== 'hohland') {
                        users.push({
                            username: child.key,
                            displayName: child.val().displayName || child.key
                        });
                    }
                });

                const usersHTML = users.map(user => `
                    <div class="user-list-item" onclick="createChat('${user.username}', '${user.displayName}')">
                        <div class="user-list-name">${user.displayName}</div>
                        <div class="user-list-username">@${user.username}</div>
                    </div>
                `).join('');

                document.getElementById('usersList').innerHTML = usersHTML;
                document.getElementById('newChatModal').classList.add('active');
            });
        }

        function closeNewChatModal() {
            document.getElementById('newChatModal').classList.remove('active');
        }

        async function createChat(username, displayName) {
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É–∂–µ —á–∞—Ç
            const chatsSnapshot = await database.ref('chats').once('value');
            let existingChatId = null;

            chatsSnapshot.forEach((child) => {
                const chatData = child.val();
                if (chatData.participants && 
                    chatData.participants[currentUsername] && 
                    chatData.participants[username]) {
                    existingChatId = child.key;
                }
            });

            if (existingChatId) {
                closeNewChatModal();
                openChat(existingChatId, username);
                return;
            }

            // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
            const currentUserSnapshot = await database.ref('users/' + currentUsername).once('value');
            const currentUserData = currentUserSnapshot.val();

            const newChatRef = database.ref('chats').push();
            await newChatRef.set({
                participants: {
                    [currentUsername]: currentUserData.displayName || currentUsername,
                    [username]: displayName
                },
                createdAt: new Date().toISOString()
            });

            closeNewChatModal();
            openChat(newChatRef.key, username);
        }

        async function openChat(chatId, otherUsername) {
            currentChatId = chatId;

            const userSnapshot = await database.ref('users/' + otherUsername).once('value');
            const userData = userSnapshot.val();

            document.getElementById('currentChatName').textContent = userData.displayName || otherUsername;
            document.getElementById('chatInputArea').style.display = 'block';

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
            database.ref('messages/' + chatId).on('value', (snapshot) => {
                const messages = [];
                snapshot.forEach((child) => {
                    messages.push({
                        id: child.key,
                        ...child.val()
                    });
                });

                messages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

                const messagesHTML = messages.length > 0
                    ? messages.map(msg => {
                        const isOwn = msg.sender === currentUsername;
                        return `
                            <div class="message-item ${isOwn ? 'own' : ''}">
                                <div class="message-avatar">${msg.senderName.charAt(0).toUpperCase()}</div>
                                <div class="message-content">
                                    <div class="message-author">${msg.senderName}</div>
                                    <div class="message-text">${msg.text}</div>
                                    <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</div>
                                </div>
                            </div>
                        `;
                    }).join('')
                    : '<div class="chat-empty"><div class="chat-empty-icon">üí¨</div><div>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ</div></div>';

                document.getElementById('chatMessages').innerHTML = messagesHTML;
                document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
            });

            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç
            loadChats();
        }

        async function sendChatMessage() {
            if (!currentChatId) return;

            const input = document.getElementById('chatInput');
            const text = input.value.trim();

            if (!text) return;

            try {
                const userSnapshot = await database.ref('users/' + currentUsername).once('value');
                const userData = userSnapshot.val();

                await database.ref('messages/' + currentChatId).push({
                    sender: currentUsername,
                    senderName: userData.displayName || currentUsername,
                    text: text,
                    timestamp: new Date().toISOString()
                });

                await database.ref('chats/' + currentChatId + '/lastMessage').set({
                    text: text,
                    timestamp: new Date().toISOString()
                });

                input.value = '';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
            }
        }

        // –§–æ—Ä—É–º
        async function loadPosts() {
            database.ref('threads').on('value', (snapshot) => {
                const threads = [];
                snapshot.forEach((child) => {
                    threads.push({
                        id: child.key,
                        ...child.val()
                    });
                });

                threads.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                const threadsHTML = threads.length > 0
                    ? threads.map(thread => `
                        <div class="thread-item" onclick="viewThread('${thread.id}')">
                            <div class="thread-header">
                                <div>
                                    <div class="thread-title">${thread.title}</div>
                                    <div class="thread-author">–ê–≤—Ç–æ—Ä: ${thread.authorName}</div>
                                </div>
                                <div class="thread-date">${new Date(thread.createdAt).toLocaleDateString('ru-RU')}</div>
                            </div>
                            <div class="thread-preview">${thread.content.substring(0, 150)}${thread.content.length > 150 ? '...' : ''}</div>
                            <div class="thread-stats">
                                <div class="thread-stat">üí¨ ${thread.repliesCount || 0} –æ—Ç–≤–µ—Ç–æ–≤</div>
                                <div class="thread-stat">üëÅÔ∏è ${thread.views || 0} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                            </div>
                        </div>
                    `).join('')
                    : '<div class="history-empty">–ù–µ—Ç —Ç–µ–º –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è</div>';

                document.getElementById('threadsList').innerHTML = threadsHTML;

                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                document.getElementById('forumStats').innerHTML = `
                    <div style="margin-bottom: 10px;">–í—Å–µ–≥–æ —Ç–µ–º: ${threads.length}</div>
                    <div>–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤: ${threads.reduce((sum, t) => sum + (t.repliesCount || 0), 0)}</div>
                `;
            });
        }

        function showNewThreadModal() {
            document.getElementById('newThreadModal').classList.add('active');
        }

        function closeNewThreadModal() {
            document.getElementById('newThreadModal').classList.remove('active');
            document.getElementById('threadTitle').value = '';
            document.getElementById('threadContent').value = '';
        }

        async function createNewThread() {
            const title = document.getElementById('threadTitle').value.trim();
            const content = document.getElementById('threadContent').value.trim();

            if (!title || !content) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            try {
                const userSnapshot = await database.ref('users/' + currentUsername).once('value');
                const userData = userSnapshot.val();

                await database.ref('threads').push({
                    title: title,
                    content: content,
                    author: currentUsername,
                    authorName: userData.displayName || currentUsername,
                    createdAt: new Date().toISOString(),
                    repliesCount: 0,
                    views: 0
                });

                closeNewThreadModal();
                alert('–¢–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∞!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–º—ã:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–º—ã');
            }
        }

        async function viewThread(threadId) {
            const threadSnapshot = await database.ref('threads/' + threadId).once('value');
            const thread = threadSnapshot.val();

            // –£–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
            await database.ref('threads/' + threadId + '/views').set((thread.views || 0) + 1);

            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–≤–µ—Ç—ã
            const repliesSnapshot = await database.ref('replies/' + threadId).once('value');
            const replies = [];
            repliesSnapshot.forEach((child) => {
                replies.push(child.val());
            });

            replies.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));

            const repliesHTML = replies.length > 0
                ? replies.map(reply => `
                    <div class="thread-reply">
                        <div class="reply-header">
                            <div class="reply-author">${reply.authorName}</div>
                            <div class="reply-date">${new Date(reply.createdAt).toLocaleString('ru-RU')}</div>
                        </div>
                        <div class="reply-body">${reply.content}</div>
                    </div>
                `).join('')
                : '<div class="history-empty">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</div>';

            const threadHTML = `
                <button class="back-to-threads" onclick="backToThreads()">‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–µ–º–∞–º</button>
                <div class="thread-main-post">
                    <div class="thread-main-header">
                        <div class="thread-main-title">${thread.title}</div>
                        <div class="thread-main-meta">
                            <span>–ê–≤—Ç–æ—Ä: ${thread.authorName}</span>
                            <span>${new Date(thread.createdAt).toLocaleString('ru-RU')}</span>
                            <span>üëÅÔ∏è ${thread.views || 0}</span>
                        </div>
                    </div>
                    <div class="thread-main-body">${thread.content}</div>
                </div>
                <div class="thread-replies-title">–û—Ç–≤–µ—Ç—ã (${replies.length})</div>
                ${repliesHTML}
                <div class="reply-form">
                    <textarea id="replyContent" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." rows="4"></textarea>
                    <button class="btn btn-primary" onclick="postReply('${threadId}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
                </div>
            `;

            document.getElementById('threadsListView').style.display = 'none';
            document.getElementById('threadView').innerHTML = threadHTML;
            document.getElementById('threadView').classList.add('active');
        }

        function backToThreads() {
            document.getElementById('threadsListView').style.display = 'block';
            document.getElementById('threadView').classList.remove('active');
        }

        async function postReply(threadId) {
            const content = document.getElementById('replyContent').value.trim();

            if (!content) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞');
                return;
            }

            try {
                const userSnapshot = await database.ref('users/' + currentUsername).once('value');
                const userData = userSnapshot.val();

                await database.ref('replies/' + threadId).push({
                    content: content,
                    author: currentUsername,
                    authorName: userData.displayName || currentUsername,
                    createdAt: new Date().toISOString()
                });

                const threadSnapshot = await database.ref('threads/' + threadId).once('value');
                const thread = threadSnapshot.val();
                await database.ref('threads/' + threadId + '/repliesCount').set((thread.repliesCount || 0) + 1);

                viewThread(threadId);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞');
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        async function updateDisplayName() {
            const newName = document.getElementById('displayNameInput').value.trim();

            if (!newName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
                return;
            }

            try {
                await database.ref('users/' + currentUsername + '/displayName').set(newName);
                alert('–ò–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
                showDashboard();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–º–µ–Ω–∏:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–º–µ–Ω–∏');
            }
        }

        async function loadLoginHistory() {
            const snapshot = await database.ref('loginHistory/' + currentUsername).once('value');
            const history = [];

            snapshot.forEach((child) => {
                history.push(child.val());
            });

            history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            const historyHTML = history.length > 0
                ? history.slice(0, 10).map(item => `
                    <div class="login-history-item">
                        <div class="login-date">${new Date(item.timestamp).toLocaleString('ru-RU')}</div>
                        <div class="login-ip">IP: ${item.ip}</div>
                    </div>
                `).join('')
                : '<div class="history-empty">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';

            document.getElementById('loginHistoryList').innerHTML = historyHTML;
        }

        async function loadAllTransactions() {
            const snapshot = await database.ref('transfers/' + currentUsername).once('value');
            const transactions = [];

            snapshot.forEach((child) => {
                transactions.push(child.val());
            });

            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

            const transactionsHTML = transactions.length > 0
                ? transactions.map(item => {
                    const isReceived = item.type === 'received';
                    return `
                        <div class="history-item">
                            <div class="history-item-header">
                                <div class="history-item-type">${isReceived ? '–ü–æ–ª—É—á–µ–Ω–æ –æ—Ç' : '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'}: ${isReceived ? item.senderName : item.recipientName}</div>
                                <div class="history-item-amount ${isReceived ? 'positive' : 'negative'}">
                                    ${isReceived ? '+' : '-'}${item.amount} √ê
                                </div>
                            </div>
                            <div class="history-item-details">${new Date(item.date).toLocaleString('ru-RU')}</div>
                        </div>
                    `;
                }).join('')
                : '<div class="history-empty">–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>';

            document.getElementById('allTransactionsList').innerHTML = transactionsHTML;
        }

        // –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
        async function loadAdminPanel() {
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const usersSnapshot = await database.ref('users').once('value');
            const cardsSnapshot = await database.ref('cards').once('value');
            const threadsSnapshot = await database.ref('threads').once('value');
            
            let totalBalance = 0;
            cardsSnapshot.forEach((child) => {
                totalBalance += child.val().balance || 0;
            });

            document.getElementById('adminStats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${usersSnapshot.numChildren()}</div>
                    <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${cardsSnapshot.numChildren()}</div>
                    <div class="stat-label">–ö–∞—Ä—Ç –≤—ã–ø—É—â–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Math.floor(totalBalance)} √ê</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –≤ —Å–∏—Å—Ç–µ–º–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${threadsSnapshot.numChildren()}</div>
                    <div class="stat-label">–¢–µ–º –Ω–∞ —Ñ–æ—Ä—É–º–µ</div>
                </div>
            `;

            // –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const users = [];
            usersSnapshot.forEach((child) => {
                if (child.key !== 'hohland') {
                    users.push({
                        username: child.key,
                        ...child.val()
                    });
                }
            });

            const usersHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                            <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>${user.displayName || user.username} (@${user.username})</td>
                                <td>${new Date(user.createdAt).toLocaleDateString('ru-RU')}</td>
                                <td>
                                    <button class="btn btn-secondary action-btn" onclick="viewUserDetails('${user.username}')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                                    <button class="btn btn-primary action-btn" onclick="changeBalance('${user.username}')">–ë–∞–ª–∞–Ω—Å</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('usersTable').innerHTML = usersHTML;

            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            const recipientSelect = document.getElementById('notificationRecipient');
            recipientSelect.innerHTML = '<option value="all">–í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</option>';
            users.forEach(user => {
                recipientSelect.innerHTML += `<option value="${user.username}">${user.displayName || user.username}</option>`;
            });
        }

        async function changeBalance(username) {
            const amount = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è):');
            if (amount === null) return;

            const amountNum = parseInt(amount);
            if (isNaN(amountNum)) {
                alert('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞');
                return;
            }

            try {
                const cardSnapshot = await database.ref('cards/' + username).once('value');
                const cardData = cardSnapshot.val();

                await database.ref('cards/' + username + '/balance').set(Math.floor(cardData.balance + amountNum));

                await database.ref('notifications/' + username).push({
                    type: amountNum > 0 ? 'success' : 'warning',
                    message: `–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä ${amountNum > 0 ? '–Ω–∞—á–∏—Å–ª–∏–ª' : '—Å–ø–∏—Å–∞–ª'} ${Math.abs(amountNum)} √ê`,
                    date: new Date().toISOString()
                });

                alert('–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', error);
                alert('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞');
            }
        }

        async function viewUserDetails(username) {
            try {
                const userSnapshot = await database.ref('users/' + username).once('value');
                const userData = userSnapshot.val();

                const cardSnapshot = await database.ref('cards/' + username).once('value');
                const cardData = cardSnapshot.val();

                const transfersSnapshot = await database.ref('transfers/' + username).once('value');
                const transfers = [];
                transfersSnapshot.forEach((child) => {
                    transfers.push(child.val());
                });

                const loginHistorySnapshot = await database.ref('loginHistory/' + username).once('value');
                const logins = [];
                loginHistorySnapshot.forEach((child) => {
                    logins.push(child.val());
                });

                let details = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userData.displayName || username}
–õ–æ–≥–∏–Ω: ${username}
–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${new Date(userData.createdAt).toLocaleString('ru-RU')}

–ö–∞—Ä—Ç–∞: ${cardData ? cardData.number : '–ù–µ—Ç –∫–∞—Ä—Ç—ã'}
–ë–∞–ª–∞–Ω—Å: ${cardData ? Math.floor(cardData.balance) + ' √ê' : 'N/A'}

–í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${transfers.length}
–í—Å–µ–≥–æ –≤—Ö–æ–¥–æ–≤: ${logins.length}

–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: ${logins.length > 0 ? new Date(logins[logins.length - 1].timestamp).toLocaleString('ru-RU') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}`;

                alert(details);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        async function sendNotification() {
            const type = document.getElementById('notificationType').value;
            const recipient = document.getElementById('notificationRecipient').value;
            const text = document.getElementById('notificationText').value.trim();

            if (!text) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
                return;
            }

            try {
                const notification = {
                    type: type,
                    message: text,
                    date: new Date().toISOString()
                };

                if (recipient === 'all') {
                    const snapshot = await database.ref('users').once('value');
                    const updates = {};

                    snapshot.forEach((childSnapshot) => {
                        if (childSnapshot.key !== 'hohland') {
                            const key = database.ref('notifications/' + childSnapshot.key).push().key;
                            updates['notifications/' + childSnapshot.key + '/' + key] = notification;
                        }
                    });

                    await database.ref().update(updates);
                } else {
                    await database.ref('notifications/' + recipient).push(notification);
                }

                document.getElementById('notificationText').value = '';
                alert('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è');
            }
        }

        function switchSection(section) {
            currentSection = section;

            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            document.querySelectorAll('.dashboard-content').forEach(content => {
                content.classList.remove('active');
            });

            const sectionMap = {
                'bank': 'bankSection',
                'messenger': 'messengerSection',
                'posts': 'postsSection',
                'settings': 'settingsSection',
                'admin': 'adminSection'
            };

            document.getElementById(sectionMap[section]).classList.add('active');

            if (section === 'posts') {
                loadPosts();
            } else if (section === 'settings') {
                loadLoginHistory();
                loadAllTransactions();
            } else if (section === 'admin' && isAdmin) {
                loadAdminPanel();
            }
        }

        function handleLogout() {
            database.ref('cards/' + currentUsername).off();
            database.ref('transfers/' + currentUsername).off();
            database.ref('notifications/' + currentUsername).off();
            database.ref('chats').off();
            database.ref('messages').off();
            database.ref('threads').off();

            localStorage.removeItem('hohlgramSession');

            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('mainContainer').classList.remove('wide');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('message').style.display = 'none';

            currentUsername = '';
            isAdmin = false;
            balanceVisible = false;

            document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const session = localStorage.getItem('hohlgramSession');
            if (session) {
                const sessionData = JSON.parse(session);
                const hoursPassed = (Date.now() - sessionData.timestamp) / (1000 * 60 * 60);

                if (hoursPassed < 24) {
                    document.getElementById('username').value = sessionData.username;
                }
            }

            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
        });

        // –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞
        database.ref('users/hohland').once('value').then((snapshot) => {
            if (!snapshot.exists()) {
                database.ref('users/hohland').set({
                    password: 'ZMKBSCw9iQ7m98YoGFNn',
                    displayName: 'Administrator',
                    createdAt: new Date().toISOString(),
                    isAdmin: true
                });
            }
        });
    </script>
</body>
</html>
